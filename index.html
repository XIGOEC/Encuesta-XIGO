<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XIGO - Encuesta de Mercado (23 Preguntas)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        xigo: '#2D5A27',
                        'xigo-light': '#f0fdf4',
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #2D5A27; border-radius: 10px; }
        .header-bg { background-color: #2D5A27; display: flex; align-items: center; justify-content: center; overflow: hidden; height: 180px; }
        .header-img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const ADMIN_PASSWORD = "XIGO2026"; 
        const LOGO_URL = "https://i.ibb.co/SD87TqHW/Black-Modern-Minimalist-Letter-A-Logo-1-1.png"; 

        const surveyData = [
            // SECCIÃ“N 0 - FILTRO
            { section: "Filtro", title: "Â¿En los Ãºltimos 30 dÃ­as, has comprado comida preparada o empacada para consumir fuera de casa?", options: ["SÃ­, lo he comprado", "No, pero lo considerarÃ­a", "No, no me interesa"], type: "single", terminateIf: "No, no me interesa" },
            { section: "Filtro", title: "Â¿CuÃ¡l describe mejor tu situaciÃ³n actual?", options: ["Trabajo fuera de casa", "Trabajo desde casa / Online", "Trabajo mixto", "Estudiante / No trabajo"], type: "single" },
            { section: "Filtro", title: "Â¿Con quÃ© frecuencia almuerzas fuera de casa en una semana laboral?", options: ["0 veces", "1 a 2 veces", "3 a 4 veces", "5 veces (todos los dÃ­as)"], type: "single" },
            
            // SECCIÃ“N 1 - COMIDA
            { section: "Comida", title: "Â¿Has comprado alguna vez comida preparada para consumir despuÃ©s (Refrigerada o en tarrinas)?", options: ["SÃ­, regularmente", "SÃ­, algunas veces", "No, pero me llama la atenciÃ³n", "No, no me interesa"], type: "single" },
            { section: "Comida", title: "Â¿En quÃ© situaciones elegirÃ­as comida lista durante un dÃ­a laboral?", options: ["Poco tiempo", "Reuniones continuas", "No alcancÃ© a cocinar", "Para comer en oficina", "Traslados", "Para llevar a casa"], type: "multiple" },
            { section: "Comida", title: "Â¿QuÃ© tipo de comida te genera mÃ¡s confianza empacada? (MÃ¡x 3)", options: ["Tradicional ecuatoriana", "Casera ligera", "Bowls balanceados", "Ensaladas completas", "Sopas / Cremas", "Snacks salados"], type: "multiple", max: 3 },
            { section: "Comida", title: "Para tu almuerzo o cena, Â¿quÃ© tamaÃ±o de porciÃ³n prefieres?", options: ["Ligero", "Normal", "Grande", "Depende del dÃ­a"], type: "single" },
            { section: "Comida", title: "Â¿QuÃ© esperas de un almuerzo para que 'valga la pena'? (MÃ¡x 3)", options: ["PorciÃ³n generosa", "Saludable/Balanceado", "Mucha proteÃ­na", "RÃ¡pido y prÃ¡ctico", "Excelente sabor"], type: "multiple", max: 3 },
            { section: "Comida", title: "Â¿QuÃ© factor te harÃ­a dudar al comprar comida lista? (MÃ¡x 3)", options: ["Frescura", "Higiene", "Sabor", "Precio", "TamaÃ±o porciÃ³n", "Conservantes", "Caducidad", "Empaque"], type: "multiple", max: 3 },
            { section: "Comida", title: "Si tuvieras acceso a comida fresca cerca, Â¿con quÃ© frecuencia la consumirÃ­as?", options: ["Nunca", "1 vez/semana", "2-3 veces/semana", "Casi todos los dÃ­as"], type: "single" },
            { section: "Comida", title: "Â¿ConsiderarÃ­as pedir comida lista por delivery si fuera de alta calidad?", options: ["SÃ­, con frecuencia", "SÃ­, ocasionalmente", "Tal vez", "No"], type: "single" },

            // SECCIÃ“N 2 - PRECIOS
            { section: "Precios", title: "Â¿CuÃ¡nto sueles pagar por tu almuerzo promedio entre semana?", options: ["Menos de $4.99", "$5.00 a $7.99", "$8.00 a $9.99", "$10.00 a $11.99", "$12.00 o mÃ¡s"], type: "single" },
            { section: "Precios", title: "Â¿QuÃ© precio te parece razonable para un almuerzo fresco y balanceado?", options: ["Menos de $4.99", "$5.00 a $7.99", "$8.00 a $9.99", "$10.00 a $11.99", "$12.00 o mÃ¡s"], type: "single" },
            { section: "Precios", title: "Â¿A partir de quÃ© precio considerarÃ­as que un almuerzo listo es demasiado CARO?", options: ["Menos de $4.99", "$5.00 a $7.99", "$8.00 a $9.99", "$10.00 a $11.99", "$12.00 o mÃ¡s"], type: "single" },
            { section: "Precios", title: "Â¿QuÃ© formato de compra te resultarÃ­a mÃ¡s atractivo?", options: ["Pedido puntual", "Pack 2-3 dÃ­as", "Pack semana laboral", "No me interesa"], type: "single" },
            { section: "Precios", title: "Si tu almuerzo de $5.99 sube a $7.99 por costos, Â¿quÃ© harÃ­as?", options: ["Seguir comprando", "Menos frecuencia", "Buscar otra opciÃ³n", "Dejar de comprar"], type: "single" },

            // SECCIÃ“N 3 - RTD
            { section: "Bebidas", title: "Â¿Compras bebidas listas para tomar (agua, jugos, tÃ©s) en el trabajo?", options: ["Diario", "Varias veces/semana", "Ocasionalmente", "Rara vez", "Nunca"], type: "single" },
            { section: "Bebidas", title: "Â¿CuÃ¡l opciÃ³n te resultarÃ­a mÃ¡s atractiva? (MÃ¡x 2)", options: ["Agua natural/saborizada", "Jugo natural prensado", "TÃ© frÃ­o/InfusiÃ³n", "CafÃ©/Matcha", "Bebida funcional", "Refrescante"], type: "multiple", max: 2 },
            { section: "Bebidas", title: "En cafÃ© o smoothies, Â¿quÃ© tipo de leche prefieres? (MÃ¡x 2)", options: ["Entera", "Deslactosada", "Almendra", "Avena", "Soya", "Sin leche"], type: "multiple", max: 2 },
            { section: "Bebidas", title: "Â¿QuÃ© precio te parece razonable para una bebida RTD premium?", options: ["Hasta $1.99", "$2.00-$2.99", "$3.00-$3.99", "$4.00-$4.99", "+$5.00"], type: "single" },

            // SECCIÃ“N 4 - PERFIL
            { section: "Perfil", title: "Â¿En quÃ© rango de edad te encuentras?", options: ["18-24", "25-34", "35-44", "45-54", "55+"], type: "single" },
            { section: "Perfil", title: "Â¿CuÃ¡l es tu gÃ©nero?", options: ["Femenino", "Masculino", "Otro"], type: "single" },
            { section: "Perfil", title: "Â¿En quÃ© zona de Guayaquil realizas tus actividades?", options: ["Norte", "Centro", "Sur", "SamborondÃ³n/VÃ­a Costa", "DurÃ¡n"], type: "single" }
        ];

        function App() {
            const [step, setStep] = useState('survey');
            const [currentIdx, setCurrentIdx] = useState(0);
            const [answers, setAnswers] = useState({});
            const [selectedInStep, setSelectedInStep] = useState([]);
            const [email, setEmail] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const [adminClicks, setAdminClicks] = useState(0);
            const [database, setDatabase] = useState([]);
            const [selectedUser, setSelectedUser] = useState(null);

            const handleAdminAccess = () => {
                const clicks = adminClicks + 1;
                if (clicks >= 5) {
                    const p = prompt("Password Admin:");
                    if (p === ADMIN_PASSWORD) setStep('admin');
                    setAdminClicks(0);
                } else setAdminClicks(clicks);
            };

            const downloadExcel = () => {
                if (database.length === 0) return alert("No hay datos para descargar");
                
                // Definir las cabeceras (Preguntas)
                const headers = ["ID", "Fecha", "Email", ...surveyData.map(q => q.title)];
                
                // Mapear cada registro a una fila
                const rows = database.map(u => {
                    const row = [u.id, u.date, u.email];
                    surveyData.forEach(q => {
                        const ans = u.responses[q.title]?.value || "N/A";
                        row.push(Array.isArray(ans) ? ans.join(" | ") : ans);
                    });
                    return row.join(",");
                });

                const csvContent = "data:text/csv;charset=utf-8," + [headers.join(","), ...rows].join("\n");
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `XIGO_Encuesta_${new Date().toLocaleDateString()}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleSelect = (val) => {
                const q = surveyData[currentIdx];
                if (q.type === 'single') {
                    setAnswers({...answers, [q.title]: { value: val, section: q.section }});
                    setSelectedInStep([val]);
                    if (q.terminateIf && val === q.terminateIf) return setStep('terminated');
                    setTimeout(() => {
                        if (currentIdx < surveyData.length - 1) {
                            setCurrentIdx(currentIdx + 1);
                            setSelectedInStep([]);
                        } else setStep('email');
                    }, 300);
                } else {
                    let updated = selectedInStep.includes(val) 
                        ? selectedInStep.filter(i => i !== val) 
                        : (q.max && selectedInStep.length >= q.max ? selectedInStep : [...selectedInStep, val]);
                    setSelectedInStep(updated);
                    setAnswers({...answers, [q.title]: { value: updated, section: q.section }});
                }
            };

            const submitSurvey = () => {
                if (!email.includes('@')) return alert("Email invÃ¡lido");
                setIsLoading(true);
                const record = { id: Date.now(), email, date: new Date().toLocaleString(), responses: answers };
                setTimeout(() => {
                    setDatabase(prev => [record, ...prev]);
                    setIsLoading(false);
                    setStep('success');
                }, 1000);
            };

            if (step === 'admin') return (
                <div className="min-h-screen bg-gray-50 p-4 font-sans overflow-y-auto">
                    <div className="max-w-6xl mx-auto">
                        <div className="flex flex-col md:flex-row justify-between items-center mb-6 bg-white p-6 rounded-3xl shadow-sm border gap-4">
                            <h1 className="text-xl font-black text-xigo">XIGO ADMIN PANEL</h1>
                            <div className="flex gap-2">
                                <button 
                                    onClick={downloadExcel}
                                    className="bg-xigo text-white px-4 py-2 rounded-xl text-xs font-bold flex items-center gap-2 hover:bg-green-800 transition-colors"
                                >
                                    ðŸ“¥ DESCARGAR EXCEL (CSV)
                                </button>
                                <button onClick={() => setStep('survey')} className="bg-gray-100 px-4 py-2 rounded-xl text-xs font-bold">Cerrar</button>
                            </div>
                        </div>
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="space-y-2 max-h-[600px] overflow-y-auto custom-scrollbar">
                                <p className="text-[10px] font-bold text-gray-400 uppercase ml-2 mb-2">Respuestas ({database.length})</p>
                                {database.map(u => (
                                    <div key={u.id} onClick={() => setSelectedUser(u)} className={`p-4 rounded-2xl cursor-pointer border transition-all ${selectedUser?.id === u.id ? 'bg-xigo text-white border-xigo shadow-lg' : 'bg-white text-gray-700 hover:border-gray-300'}`}>
                                        <p className="font-bold truncate text-sm">{u.email}</p>
                                        <p className="text-[10px] uppercase opacity-70">{u.date}</p>
                                    </div>
                                ))}
                                {database.length === 0 && (
                                    <div className="bg-white p-8 rounded-2xl border border-dashed text-center text-gray-400 text-sm">
                                        No hay respuestas registradas aÃºn.
                                    </div>
                                )}
                            </div>
                            <div className="lg:col-span-2 bg-white rounded-3xl p-6 border min-h-[500px]">
                                {selectedUser ? (
                                    <div className="fade-in">
                                        <div className="flex justify-between items-center mb-4 border-b pb-2">
                                            <h3 className="text-lg font-black">{selectedUser.email}</h3>
                                            <span className="text-[10px] font-bold bg-gray-100 px-2 py-1 rounded text-gray-500">{selectedUser.date}</span>
                                        </div>
                                        <div className="space-y-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                                            {surveyData.map((q, i) => {
                                                const userAns = selectedUser.responses[q.title];
                                                return (
                                                    <div key={i} className="bg-gray-50 p-3 rounded-xl border border-gray-100">
                                                        <div className="flex justify-between mb-1">
                                                            <p className="text-[9px] font-black text-gray-400 uppercase">{q.section}</p>
                                                        </div>
                                                        <p className="text-xs font-bold text-gray-600 mb-1">{q.title}</p>
                                                        <p className="text-sm font-black text-xigo">
                                                            {userAns ? (Array.isArray(userAns.value) ? userAns.value.join(", ") : userAns.value) : "Sin respuesta"}
                                                        </p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ) : <div className="h-full flex flex-col items-center justify-center text-gray-300 italic py-20">
                                        <span className="text-4xl mb-2">ðŸ“‚</span>
                                        <p>Selecciona un registro para ver el detalle</p>
                                    </div>}
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen flex items-center justify-center bg-gray-50 p-4 font-sans">
                    <div className="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col h-[700px] border">
                        <div onClick={handleAdminAccess} className="header-bg flex-shrink-0 cursor-pointer">
                            <img src={LOGO_URL} className="header-img" />
                        </div>
                        <div className="p-8 flex-grow flex flex-col overflow-hidden">
                            {step === 'survey' && (
                                <div className="fade-in h-full flex flex-col">
                                    <div className="w-full bg-gray-100 h-1 rounded-full mb-6">
                                        <div className="bg-xigo h-full transition-all duration-500" style={{width: `${((currentIdx+1)/surveyData.length)*100}%`}}></div>
                                    </div>
                                    <div className="flex-grow overflow-y-auto custom-scrollbar pr-1">
                                        <p className="text-xigo font-black text-[9px] uppercase tracking-widest mb-1 opacity-60">{surveyData[currentIdx].section}</p>
                                        <h2 className="text-lg font-black text-gray-800 leading-tight mb-6">{surveyData[currentIdx].title}</h2>
                                        <div className="space-y-2">
                                            {surveyData[currentIdx].options.map(o => (
                                                <button key={o} onClick={() => handleSelect(o)} className={`w-full p-4 rounded-2xl text-left text-sm font-bold border-2 transition-all ${selectedInStep.includes(o) ? 'border-xigo bg-xigo-light text-xigo shadow-sm' : 'border-gray-50 text-gray-600 hover:border-gray-200'}`}>{o}</button>
                                            ))}
                                        </div>
                                    </div>
                                    {surveyData[currentIdx].type === 'multiple' && selectedInStep.length > 0 && (
                                        <button onClick={() => {setCurrentIdx(currentIdx+1); setSelectedInStep([])}} className="mt-4 w-full bg-xigo text-white py-4 rounded-2xl font-black uppercase tracking-widest">Siguiente</button>
                                    )}
                                </div>
                            )}
                            {step === 'email' && (
                                <div className="fade-in text-center flex flex-col justify-center h-full">
                                    <h2 className="text-2xl font-black mb-4">Â¡LOGRADO!</h2>
                                    <p className="text-sm text-gray-500 mb-8 font-medium">Completa tu correo para recibir el cupÃ³n de **Vina MarÃ­a**.</p>
                                    <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="tu@email.com" className="p-4 border-2 rounded-2xl mb-4 text-center font-bold outline-none focus:border-xigo"/>
                                    <button onClick={submitSurvey} className="bg-xigo text-white py-4 rounded-2xl font-black uppercase tracking-widest w-full">Finalizar</button>
                                </div>
                            )}
                            {step === 'success' && (
                                <div className="fade-in text-center flex flex-col justify-center h-full">
                                    <div className="text-5xl mb-4 animate-bounce">ðŸš€</div>
                                    <h2 className="text-2xl font-black text-xigo">Â¡GRACIAS!</h2>
                                    <p className="text-gray-500 text-sm mt-2">Tus respuestas valen oro para XIGO.</p>
                                    <button onClick={() => window.location.reload()} className="mt-8 text-xigo font-bold text-xs underline">Volver al inicio</button>
                                </div>
                            )}
                            {step === 'terminated' && (
                                <div className="fade-in text-center flex flex-col justify-center h-full">
                                    <h2 className="text-xl font-black mb-4 text-gray-400 uppercase">Gracias por tu tiempo</h2>
                                    <p className="text-sm text-gray-400 mb-8">Esta encuesta estÃ¡ dirigida a consumidores actuales o potenciales de comida empacada.</p>
                                    <button onClick={() => window.location.reload()} className="text-xigo font-bold text-xs underline">Reiniciar</button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
