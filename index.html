<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XIGO - Encuesta</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --xigo-green: #2D5A27; --xigo-bg: #f8fafc; }
        body { background-color: var(--xigo-bg); font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 0; }
        
        .main-card {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        /* DISEÃ‘O DE CABECERA RECORTADA */
        .header-logo-container {
            width: 100%;
            height: 120px; /* Altura reducida para que no sea tan larga */
            overflow: hidden;
            background-color: var(--xigo-green);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-logo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Recorta la imagen para llenar el contenedor sin deformarse */
            display: block;
        }

        .option-btn {
            width: 100%;
            text-align: left;
            padding: 18px 20px;
            margin-bottom: 12px;
            border: 2px solid #edf2f7;
            border-radius: 12px;
            transition: all 0.2s;
            font-weight: 500;
            color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .option-btn:active { transform: scale(0.98); }
        .option-selected {
            border-color: var(--xigo-green);
            background-color: #f0fdf4;
            color: var(--xigo-green);
        }

        .progress-bar {
            height: 6px;
            background: #edf2f7;
            width: 100%;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: var(--xigo-green);
            transition: width 0.3s ease;
        }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="main-card">
    <!-- Cabecera recortada -->
    <div class="header-logo-container" id="admin-trigger">
        <img src="https://lh3.googleusercontent.com/u/0/d/1WmKpnJPnBgB3OyYqe-a-OgRODLuuPjTq=w1000" alt="XIGO Logo" onerror="this.src='https://placehold.co/800x300/2D5A27/FFFFFF?text=XIGO+BEBIENDO+Y+COMIENDO'">
    </div>

    <!-- Progreso -->
    <div class="progress-bar">
        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
    </div>

    <div class="px-6 py-4 flex justify-between items-center text-[10px] font-bold text-gray-400 uppercase tracking-widest">
        <span id="label-bloque">Cargando...</span>
        <span id="label-paso">1 / 23</span>
    </div>

    <!-- Contenido -->
    <main id="content" class="flex-1 px-6 py-4">
        <!-- Preguntas dinÃ¡micas -->
    </main>

    <!-- BotÃ³n para selecciÃ³n mÃºltiple -->
    <footer id="footer-actions" class="p-6 hidden">
        <button onclick="nextStep()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold uppercase tracking-widest shadow-lg">
            Continuar
        </button>
    </footer>
</div>

<script>
    const questions = [
        { id: 'F1', b: 'Filtro', q: 'Â¿En los Ãºltimos 30 dÃ­as, has comprado comida preparada o empacada para consumir fuera de casa, trabajo o universidad?', o: ['SÃ­, lo he comprado', 'No, pero lo considerarÃ­a si fuera conveniente', 'No, no me interesa'], t: 'single', exit: 'No, no me interesa' },
        { id: 'F2', b: 'Filtro', q: 'Â¿CuÃ¡l describe mejor tu situaciÃ³n actual?', o: ['Trabajo fuera de casa', 'Trabajo desde casa/online', 'Trabajo mixto [Oficina + casa]', 'Estudiante / No trabajo'], t: 'single' },
        { id: 'F3', b: 'Filtro', q: 'Â¿Con quÃ© frecuencia almuerzas fuera de casa en una semana?', o: ['0 veces', '1-2 veces', '3-4 veces', '5+ veces'], t: 'single' },
        
        { id: 'C1', b: 'Comida', q: 'Â¿Has comprado alguna vez comida preparada para consumir despuÃ©s (Refrigerada o en tarrinas)?', o: ['SÃ­, regularmente', 'SÃ­, algunas veces', 'No, pero me llama la atenciÃ³n', 'No, no me interesa'], t: 'single' },
        { id: 'C2', b: 'Comida', q: 'Â¿En quÃ© situaciones considerarÃ­as consumir comida lista durante un dÃ­a laboral?', o: ['Con poco tiempo para almorzar', 'Reuniones o trabajo continuo', 'No alcancÃ© a cocinarme', 'Para comer en la oficina', 'Entre reuniones o traslados', 'Para llevar a casa', 'No lo considera'], t: 'multi', m: 7 },
        { id: 'C3', b: 'Comida', q: 'Â¿QuÃ© tipo de comida te genera mÃ¡s apetito y confianza si viene empacada?', o: ['Comida tradicional ecuatoriana', 'Comida casera ligera', 'Bowls balanceados (sushi, proteÃ­na)', 'Ensaladas completas', 'Sopas / Cremas', 'Snacks salados', 'No confiarÃ­a'], t: 'multi', m: 3 },
        { id: 'C4', b: 'Comida', q: 'Â¿QuÃ© tamaÃ±o de porciÃ³n prefieres normalmente para tu almuerzo/cena?', o: ['Ligero', 'Normal', 'Grande', 'Depende del dÃ­a'], t: 'single' },
        { id: 'C5', b: 'Comida', q: 'Â¿QuÃ© esperas de un almuerzo para sentir que "valiÃ³ la pena"?', o: ['Que me llene', 'Que sea saludable', 'Buena cantidad de proteÃ­na', 'RÃ¡pido y prÃ¡ctico', 'Muy buen sabor'], t: 'multi', m: 3 },
        { id: 'C6', b: 'Comida', q: 'Â¿QuÃ© factor te harÃ­a dudar al comprar?', o: ['Frescura', 'Higiene', 'Sabor', 'Precio', 'TamaÃ±o', 'Conservantes', 'Caducidad', 'Empaque sostenible'], t: 'multi', m: 3 },
        { id: 'C7', b: 'Comida', q: 'Â¿Con quÃ© frecuencia consumirÃ­as comida fresca de calidad cerca de tu rutina?', o: ['Nunca', '1 vez por semana', '2-3 veces por semana', 'Casi todos los dÃ­as'], t: 'single' },
        
        { id: 'D1', b: 'Delivery', q: 'Â¿ConsiderarÃ­as pedir comida lista por delivery si fuera confiable y fresca?', o: ['SÃ­, con frecuencia', 'SÃ­, ocasionalmente', 'Tal vez', 'No'], t: 'single' },
        { id: 'D2', b: 'Delivery', q: 'Â¿QuÃ© formato de pedido por delivery te resulta mÃ¡s atractivo?', o: ['Comida puntual', 'Para 2-3 dÃ­as', 'Para toda la semana', 'Depende del dÃ­a', 'No pedirÃ­a'], t: 'single' },
        { id: 'D3', b: 'Delivery', q: 'Â¿Con quÃ© frecuencia pedirÃ­as comida lista por delivery?', o: ['Nunca', '1 vez por semana', '2-3 veces por semana', 'MÃ¡s de 3 veces por semana'], t: 'single' },
        
        { id: 'P1', b: 'Precios', q: 'Â¿CuÃ¡nto sueles pagar hoy por tu almuerzo entre semana?', o: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o mÃ¡s', 'No pago almuerzo'], t: 'single' },
        { id: 'P2', b: 'Precios', q: 'Â¿QuÃ© precio te parece razonable para un almuerzo de excelente calidad nutricional?', o: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o mÃ¡s'], t: 'single' },
        { id: 'P3', b: 'Precios', q: 'Â¿A partir de quÃ© precio considerarÃ­as que un almuerzo ya es CARO?', o: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o mÃ¡s'], t: 'single' },
        { id: 'P4', b: 'Precios', q: 'Si un almuerzo de $5.99 subiera a $7.99 por mejora de ingredientes, Â¿quÃ© harÃ­as?', o: ['Lo seguirÃ­a comprando igual', 'ComprarÃ­a con menos frecuencia', 'BuscarÃ­a otra opciÃ³n', 'DejarÃ­a de comprarlo'], t: 'single' },
        
        { id: 'R1', b: 'Bebidas', q: 'Durante tu jornada laboral, Â¿compras bebidas listas para tomar?', o: ['SÃ­, casi todos los dÃ­as', 'Varias veces por semana', 'Ocasionalmente', 'Rara vez', 'Nunca'], t: 'single' },
        { id: 'R2', b: 'Bebidas', q: 'Â¿CuÃ¡l opciÃ³n de bebida te resulta mÃ¡s atractiva?', o: ['Agua saborizada', 'Jugo natural prensado', 'TÃ© frÃ­o o infusiÃ³n', 'CafÃ© latte / Matcha', 'Bebida funcional', 'Refrescante', 'No suelo comprar'], t: 'multi', m: 2 },
        { id: 'R3', b: 'Bebidas', q: 'Â¿QuÃ© tipo de leche prefieres en tus bebidas?', o: ['Entera', 'Deslactosada', 'Almendra', 'Avena', 'Soya', 'No consumo leche'], t: 'multi', m: 2 },
        { id: 'R4', b: 'Bebidas', q: 'Â¿QuÃ© precio te parece razonable para una bebida de buena calidad?', o: ['Hasta $1.99', '$2.49 - $2.99', '$3.49 - $3.99', '$4.49 - $4.99', 'MÃ¡s de $5.00'], t: 'single' },
        
        { id: 'E1', b: 'Perfil', q: 'Â¿CuÃ¡l es tu rango de edad?', o: ['18-24', '25-34', '35-44', '45-54', '55+'], t: 'single' },
        { id: 'Z1', b: 'Perfil', q: 'Â¿En quÃ© zona realizas la mayorÃ­a de tus actividades?', o: ['Norte', 'Centro', 'Sur', 'SamborondÃ³n / VÃ­a a la Costa', 'DurÃ¡n'], t: 'single' }
    ];

    let current = 0;
    let results = {};
    let multiTemp = [];
    let adminCounter = 0;

    function render() {
        const step = questions[current];
        const container = document.getElementById('content');
        const footer = document.getElementById('footer-actions');
        
        document.getElementById('label-bloque').innerText = `Bloque: ${step.b}`;
        document.getElementById('label-paso').innerText = `${current + 1} / ${questions.length}`;
        document.getElementById('progress-fill').style.width = `${((current) / questions.length) * 100}%`;
        
        multiTemp = [];
        footer.classList.add('hidden');

        let html = `
            <div class="fade-in">
                <h2 class="text-2xl font-bold text-slate-800 leading-tight mb-8">${step.q}</h2>
                <div id="options-list">
                    ${step.o.map((opt, i) => `
                        <button onclick="handleSelect('${opt.replace(/'/g, "\\'")}')" class="option-btn">
                            <span>${opt}</span>
                            <div class="dot w-3 h-3 rounded-full bg-gray-100"></div>
                        </button>
                    `).join('')}
                </div>
                ${step.t === 'multi' ? `<p class="text-[10px] text-center text-gray-400 mt-4 font-bold">PUEDES ELEGIR HASTA ${step.m} OPCIONES</p>` : ''}
            </div>
        `;
        container.innerHTML = html;
    }

    window.handleSelect = (val) => {
        const step = questions[current];
        if (step.t === 'single') {
            if (step.exit && val === step.exit) return finishNoInteres();
            results[step.id] = val;
            nextStep();
        } else {
            if (multiTemp.includes(val)) {
                multiTemp = multiTemp.filter(x => x !== val);
            } else if (multiTemp.length < step.m) {
                multiTemp.push(val);
            }
            updateMultiUI();
            document.getElementById('footer-actions').classList.remove('hidden');
        }
    }

    function updateMultiUI() {
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => {
            const txt = b.querySelector('span').innerText;
            if (multiTemp.includes(txt)) b.classList.add('option-selected');
            else b.classList.remove('option-selected');
        });
    }

    window.nextStep = () => {
        if (questions[current].t === 'multi') {
            results[questions[current].id] = multiTemp.join(", ");
        }
        
        current++;
        if (current < questions.length) render();
        else renderEnd();
    }

    function renderEnd() {
        document.getElementById('progress-fill').style.width = "100%";
        document.getElementById('footer-actions').classList.add('hidden');
        document.getElementById('content').innerHTML = `
            <div class="text-center py-10 fade-in">
                <div class="text-5xl mb-6">ðŸ¥—</div>
                <h2 class="text-3xl font-black text-slate-800 mb-4 uppercase italic">Â¡TERMINAMOS!</h2>
                <p class="text-gray-500 mb-8 text-sm">Ingresa tu correo para recibir tu <b>15% de descuento</b> en Vina MarÃ­a:</p>
                <input type="email" id="email" placeholder="tu@email.com" class="w-full p-4 rounded-xl border-2 border-gray-100 mb-6 text-center font-bold">
                <button onclick="finalSave()" class="w-full bg-green-700 text-white py-4 rounded-xl font-bold uppercase tracking-widest">Obtener CupÃ³n</button>
            </div>
        `;
    }

    function finalSave() {
        const mail = document.getElementById('email').value;
        if (!mail.includes('@')) return alert("Por favor ingresa un correo vÃ¡lido");
        
        const data = { email: mail, responses: results, date: new Date().toLocaleString() };
        let db = JSON.parse(localStorage.getItem('xigo_results') || '[]');
        db.push(data);
        localStorage.setItem('xigo_results', JSON.stringify(db));

        document.getElementById('content').innerHTML = `
            <div class="text-center py-10 fade-in">
                <div class="bg-green-50 text-green-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 text-2xl font-bold">âœ“</div>
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2">Tu cÃ³digo es:</p>
                <div class="border-4 border-dashed border-gray-100 p-8 rounded-3xl mb-8">
                    <h2 class="text-5xl font-black text-green-800 italic">XIGO15</h2>
                </div>
                <p class="text-xs text-gray-400 italic">Muestra esta pantalla en @vinamariaec para canjear tu beneficio.</p>
                <button onclick="location.reload()" class="mt-12 text-[10px] font-bold text-gray-300 underline uppercase">Cerrar</button>
            </div>
        `;
    }

    function finishNoInteres() {
        document.getElementById('content').innerHTML = `
            <div class="text-center py-20 fade-in">
                <p class="text-gray-400 font-bold">Gracias por tu tiempo.</p>
                <button onclick="location.reload()" class="mt-4 text-green-700 font-bold underline">Reiniciar</button>
            </div>
        `;
    }

    // ACCESO ADMIN
    document.getElementById('admin-trigger').onclick = () => {
        adminCounter++;
        if (adminCounter >= 5) {
            adminCounter = 0;
            if (prompt("ContraseÃ±a:") === "2026") showAdmin();
        }
    }

    function showAdmin() {
        const db = JSON.parse(localStorage.getItem('xigo_results') || '[]');
        let html = `<div class="p-4 overflow-y-auto" style="max-height: 80vh;">
            <h2 class="font-bold text-xl mb-4">Panel Admin (${db.length})</h2>
            <div class="flex gap-2 mb-6">
                <button onclick="downloadCSV()" class="flex-1 bg-blue-600 text-white p-3 rounded-lg text-xs font-bold uppercase">Excel (CSV)</button>
                <button onclick="downloadReport()" class="flex-1 bg-green-700 text-white p-3 rounded-lg text-xs font-bold uppercase tracking-tight">Reporte Texto</button>
            </div>
            <div class="space-y-3">`;
        
        db.reverse().forEach(r => {
            html += `<div class="text-[10px] p-2 bg-gray-50 border rounded">
                <p class="font-bold text-slate-800">${r.email}</p>
                <p class="text-gray-400">${r.date}</p>
            </div>`;
        });

        html += `</div><button onclick="location.reload()" class="mt-8 w-full p-4 text-gray-400 font-bold uppercase text-xs">Cerrar Panel</button></div>`;
        document.getElementById('content').innerHTML = html;
    }

    // NUEVA FUNCIÃ“N: Descargar Reporte de Texto Ordenado
    window.downloadReport = () => {
        const db = JSON.parse(localStorage.getItem('xigo_results') || '[]');
        if(db.length === 0) return alert("No hay datos para descargar");

        let report = "========================================\n";
        report += "    REPORTE DE RESPUESTAS XIGO\n";
        report += "========================================\n\n";

        db.forEach((entry, index) => {
            report += `USUARIO #${index + 1}\n`;
            report += `Email: ${entry.email}\n`;
            report += `Fecha: ${entry.date}\n`;
            report += `----------------------------------------\n`;
            
            questions.forEach(q => {
                const answer = entry.responses[q.id] || "Sin respuesta";
                report += `[${q.id}] ${q.q}\n`;
                report += `R: ${answer}\n\n`;
            });
            report += `========================================\n\n`;
        });

        const blob = new Blob([report], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Reporte_XIGO_Detallado.txt';
        a.click();
    }

    window.downloadCSV = () => {
        const db = JSON.parse(localStorage.getItem('xigo_results') || '[]');
        let csv = "Email,Fecha," + questions.map(q => q.id).join(",") + "\n";
        db.forEach(r => {
            let row = [r.email, r.date];
            questions.forEach(q => row.push(`"${r.responses[q.id] || ''}"`));
            csv += row.join(",") + "\n";
        });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'resultados_xigo.csv';
        a.click();
    }

    window.onload = render;
</script>

</body>
</html>
