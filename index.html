<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XIGO - Encuesta de Mercado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --xigo: #2D5A27; --xigo-light: #f0fdf4; }
        .text-xigo { color: var(--xigo); }
        .bg-xigo { background-color: var(--xigo); }
        .border-xigo { border-color: var(--xigo); }
        
        body { background-color: #f1f5f9; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        
        .app-container { 
            max-width: 500px; 
            margin: 0 auto; 
            min-height: 100vh; 
            background: white; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
        }

        /* Cabecera con logo a pantalla completa */
        .brand-header { 
            width: 100%;
            aspect-ratio: 16 / 6;
            background-color: white;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .brand-header img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cubre todo el espacio horizontal */
        }

        .option-btn {
            width: 100%;
            text-align: left;
            padding: 1rem 1.25rem;
            border: 2px solid #f1f5f9;
            border-radius: 1rem;
            font-weight: 600;
            color: #475569;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .option-btn:active { transform: scale(0.98); }
        .option-selected {
            border-color: var(--xigo);
            background-color: var(--xigo-light);
            color: var(--xigo);
        }

        .progress-dot {
            height: 4px;
            background: #e2e8f0;
            flex: 1;
            margin: 0 2px;
            border-radius: 2px;
        }
        .progress-dot.active { background: var(--xigo); }

        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>

<div class="app-container">
    <header class="brand-header" id="admin-trigger">
        <img src="https://lh3.googleusercontent.com/u/0/d/1WmKpnJPnBgB3OyYqe-a-OgRODLuuPjTq=w1000" alt="XIGO Header" onerror="this.src='https://placehold.co/600x200/2D5A27/FFFFFF?text=XIGO+BEBIENDO+Y+COMIENDO'">
    </header>

    <!-- Barra de Progreso Superior -->
    <div class="px-6 py-4 border-b border-gray-50">
        <div class="flex justify-between items-center mb-2">
            <span id="block-title" class="text-[10px] font-black text-xigo uppercase tracking-widest italic">Cargando...</span>
            <span id="step-count" class="text-[10px] font-bold text-gray-300">0/23</span>
        </div>
        <div class="flex" id="progress-dots"></div>
    </div>

    <main id="survey-content" class="flex-1 px-6 py-8 overflow-y-auto custom-scroll">
        <!-- Contenido din√°mico -->
    </main>

    <footer id="survey-footer" class="p-6 border-t border-gray-50 hidden">
        <button id="next-btn" onclick="handleNext()" class="w-full bg-xigo text-white py-4 rounded-xl font-bold uppercase tracking-widest shadow-lg hover:opacity-90 transition-opacity">
            Siguiente
        </button>
    </footer>
</div>

<script>
    // --- LISTADO DE 23 PREGUNTAS SEG√öN PDF ---
    const questions = [
        // BLOQUE 0: FILTRO
        { id: 'F1', block: 'Filtro', q: '¬øEn los √∫ltimos 30 d√≠as, has comprado comida preparada o empacada para consumir fuera de casa, trabajo o universidad?', opt: ['S√≠, lo he comprado', 'No, pero lo considerar√≠a si fuera conveniente', 'No, no me interesa'], type: 'single', exit: 'No, no me interesa' },
        { id: 'F2', block: 'Filtro', q: '¬øCu√°l describe mejor tu situaci√≥n actual?', opt: ['Trabajo fuera de casa', 'Trabajo desde casa/online', 'Trabajo mixto [Oficina + casa]', 'Estudiante / No trabajo'], type: 'single' },
        { id: 'F3', block: 'Filtro', q: '¬øCon qu√© frecuencia almuerzas fuera de casa en una semana?', opt: ['0 veces', '1-2 veces', '3-4 veces', '5+ veces'], type: 'single' },
        
        // BLOQUE 1: COMIDA
        { id: 'C1', block: 'Comida', q: '¬øHas comprado alguna vez comida preparada para consumir despu√©s (Refrigerada o en tarrinas)?', opt: ['S√≠, regularmente', 'S√≠, algunas veces', 'No, pero me llama la atenci√≥n', 'No, no me interesa'], type: 'single' },
        { id: 'C2', block: 'Comida', q: '¬øEn qu√© situaciones considerar√≠as consumir comida lista durante un d√≠a laboral?', opt: ['Con poco tiempo para almorzar', 'Reuniones o trabajo continuo', 'No alcanc√© a cocinarme', 'Para comer en la oficina', 'Entre reuniones o traslados', 'Para llevar a casa', 'No lo considera'], type: 'multi', max: 7 },
        { id: 'C3', block: 'Comida', q: '¬øQu√© tipo de comida te genera m√°s apetito y confianza si viene empacada?', opt: ['Comida tradicional ecuatoriana', 'Comida casera ligera (arroz, carne, pollo)', 'Bowls balanceados (sushi, prote√≠na, pasta)', 'Ensaladas completas', 'Sopas / Cremas', 'Snacks salados', 'No confiar√≠a en comida empacada'], type: 'multi', max: 3 },
        { id: 'C4', block: 'Comida', q: '¬øQu√© tama√±o de porci√≥n prefieres normalmente para tu almuerzo/cena?', opt: ['Ligero (para no sentirse pesado)', 'Normal (me deja satisfecho)', 'Grande (me gusta quedar lleno)', 'Depende del d√≠a'], type: 'single' },
        { id: 'C5', block: 'Comida', q: '¬øQu√© esperas de un almuerzo para sentir que "vali√≥ la pena"?', opt: ['Que me llene (porci√≥n)', 'Que sea saludable', 'Buena cantidad de prote√≠na', 'Que sea r√°pido y pr√°ctico', 'Que tenga muy buen sabor'], type: 'multi', max: 3 },
        { id: 'C6', block: 'Comida', q: '¬øQu√© factor te har√≠a dudar al comprar?', opt: ['Frescura', 'Higiene', 'Sabor', 'Precio', 'Tama√±o de la porci√≥n', 'Uso de conservantes', 'Fecha de caducidad', 'Empaque sostenible'], type: 'multi', max: 3 },
        { id: 'C7', block: 'Comida', q: 'Si tuvieras acceso a comida fresca y de calidad en tu rutina, ¬øcon qu√© frecuencia la consumir√≠as?', opt: ['Nunca', '1 vez por semana', '2-3 veces por semana', 'Casi todos los d√≠as'], type: 'single' },
        
        // BLOQUE 2: DELIVERY
        { id: 'D1', block: 'Delivery', q: '¬øConsiderar√≠as pedir comida lista por delivery si fuera confiable y fresca?', opt: ['S√≠, con frecuencia', 'S√≠, ocasionalmente', 'Tal vez', 'No'], type: 'single' },
        { id: 'D2', block: 'Delivery', q: '¬øQu√© formato de pedido por delivery te resulta m√°s atractivo?', opt: ['Pedir comida puntual del momento', 'Pedir comida para 2-3 d√≠as', 'Pedir comida para toda la semana', 'Depende del d√≠a', 'No pedir√≠a por delivery'], type: 'single' },
        { id: 'D3', block: 'Delivery', q: '¬øCon qu√© frecuencia crees que pedir√≠as comida lista por delivery?', opt: ['Nunca', '1 vez por semana', '2-3 veces por semana', 'M√°s de 3 veces por semana'], type: 'single' },
        
        // BLOQUE 3: PRECIOS
        { id: 'P1', block: 'Precios', q: '¬øEn promedio, cu√°nto sueles pagar hoy por tu almuerzo entre semana?', opt: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o m√°s', 'No pago almuerzo'], type: 'single' },
        { id: 'P2', block: 'Precios', q: '¬øQu√© precio te parece razonable para un almuerzo listo, fresco y de calidad nutricional?', opt: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o m√°s'], type: 'single' },
        { id: 'P3', block: 'Precios', q: '¬øA partir de qu√© precio considerar√≠as que este tipo de almuerzo ya es CARO?', opt: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o m√°s'], type: 'single' },
        { id: 'P4', block: 'Precios', q: 'Si un almuerzo que hoy compras a $5.99 subiera a $7.99 por mejora de ingredientes, ¬øqu√© har√≠as?', opt: ['Lo seguir√≠a comprando igual', 'Lo comprar√≠a con menos frecuencia', 'Buscar√≠a otra opci√≥n', 'Dejar√≠a de comprarlo'], type: 'single' },
        
        // BLOQUE 4: RTD (Bebidas)
        { id: 'R1', block: 'Bebidas', q: 'Durante tu jornada laboral, ¬øcompras bebidas listas para tomar?', opt: ['S√≠, casi todos los d√≠as', 'Varias veces por semana', 'Ocasionalmente', 'Rara vez', 'Nunca'], type: 'single' },
        { id: 'R2', block: 'Bebidas', q: '¬øCu√°l de estas opciones te resultar√≠a m√°s atractiva en tu d√≠a a d√≠a?', opt: ['Agua natural o saborizada', 'Jugo natural prensado / fresco', 'T√© fr√≠o o infusi√≥n natural', 'Caf√© latte y Matcha', 'Bebida funcional (energ√≠a/prote√≠na)', 'Refrescante para el calor', 'No suelo comprar bebidas'], type: 'multi', max: 2 },
        { id: 'R3', block: 'Bebidas', q: '¬øQu√© tipo de leche prefieres normalmente en tus bebidas?', opt: ['Leche entera', 'Leche deslactosada', 'Leche de almendra', 'Leche de avena', 'Leche de soya', 'No consumo leche'], type: 'multi', max: 2 },
        { id: 'R4', block: 'Bebidas', q: '¬øQu√© precio te parece razonable para una bebida de buena calidad?', opt: ['Hasta $1.99', '$2.49 - $2.99', '$3.49 - $3.99', '$4.49 - $4.99', 'M√°s de $5.00'], type: 'single' },
        
        // BLOQUE FINAL: PERFIL
        { id: 'E1', block: 'Perfil', q: '¬øCu√°l es tu rango de edad?', opt: ['18-24', '25-34', '35-44', '45-54', '55+'], type: 'single' },
        { id: 'Z1', block: 'Perfil', q: '¬øEn qu√© zona realizas la mayor√≠a de tus actividades?', opt: ['Norte', 'Centro', 'Sur', 'Samborond√≥n / V√≠a a la Costa', 'Dur√°n'], type: 'single' }
    ];

    let current = 0;
    let responses = {};
    let multiSelection = [];
    let adminClicks = 0;

    function init() {
        renderProgress();
        renderQuestion();
    }

    function renderProgress() {
        const container = document.getElementById('progress-dots');
        container.innerHTML = '';
        questions.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.className = `progress-dot ${i <= current ? 'active' : ''}`;
            container.appendChild(dot);
        });
        document.getElementById('step-count').innerText = `${current + 1} / ${questions.length}`;
    }

    function renderQuestion() {
        const item = questions[current];
        const ui = document.getElementById('survey-content');
        const footer = document.getElementById('survey-footer');
        
        document.getElementById('block-title').innerText = `Bloque: ${item.block}`;
        multiSelection = [];
        footer.classList.toggle('hidden', item.type === 'single');

        let html = `
            <div class="fade-in">
                <h2 class="text-2xl font-black text-gray-800 leading-tight mb-8">${item.q}</h2>
                <div class="space-y-1">
                    ${item.opt.map(o => `
                        <button onclick="selectOption('${o.replace(/'/g, "\\'")}')" class="option-btn group">
                            <span>${o}</span>
                            <div class="w-2 h-2 rounded-full bg-gray-100 group-[.option-selected]:bg-xigo"></div>
                        </button>
                    `).join('')}
                </div>
                ${item.type === 'multi' ? `<p class="text-[10px] text-center text-gray-400 font-bold uppercase mt-6 italic">Selecciona hasta ${item.max}</p>` : ''}
            </div>
        `;
        ui.innerHTML = html;
        ui.scrollTop = 0;
    }

    window.selectOption = (val) => {
        const item = questions[current];
        if (item.type === 'single') {
            if (item.exit && val === item.exit) return finishExit();
            responses[item.id] = val;
            goNext();
        } else {
            if (multiSelection.includes(val)) {
                multiSelection = multiSelection.filter(x => x !== val);
            } else if (multiSelection.length < item.max) {
                multiSelection.push(val);
            }
            updateMultiVisuals();
        }
    };

    function updateMultiVisuals() {
        document.querySelectorAll('.option-btn').forEach(btn => {
            const text = btn.querySelector('span').innerText;
            if (multiSelection.includes(text)) {
                btn.classList.add('option-selected');
            } else {
                btn.classList.remove('option-selected');
            }
        });
    }

    window.handleNext = () => {
        const item = questions[current];
        if (item.type === 'multi' && multiSelection.length > 0) {
            responses[item.id] = multiSelection;
            goNext();
        }
    };

    function goNext() {
        current++;
        if (current < questions.length) {
            renderProgress();
            renderQuestion();
        } else {
            renderFinal();
        }
    }

    function renderFinal() {
        document.getElementById('survey-footer').classList.add('hidden');
        document.getElementById('survey-content').innerHTML = `
            <div class="text-center py-10 fade-in">
                <div class="text-6xl mb-6">ü•ó</div>
                <h2 class="text-3xl font-black text-gray-800 mb-4 uppercase italic">¬°Excelente!</h2>
                <p class="text-gray-500 font-medium mb-10 text-sm">Para recibir tu cup√≥n del 15% en Vina Mar√≠a, ingresa tu correo:</p>
                <input type="email" id="user-email" placeholder="Email para el cup√≥n" class="w-full p-4 bg-gray-50 rounded-xl border-2 border-gray-100 focus:border-xigo outline-none text-center font-bold mb-6">
                <button onclick="saveData()" class="w-full bg-xigo text-white py-4 rounded-xl font-black uppercase tracking-widest shadow-xl">Reclamar Cup√≥n</button>
            </div>
        `;
    }

    function saveData() {
        const email = document.getElementById('user-email').value;
        if (!email.includes('@')) return alert("Ingresa un correo v√°lido");
        
        const finalData = { email, responses, date: new Date().toISOString() };
        
        // Guardado local (Perfecto para GitHub Pages)
        let storage = JSON.parse(localStorage.getItem('xigo_data') || '[]');
        storage.push(finalData);
        localStorage.setItem('xigo_data', JSON.stringify(storage));

        showCoupon();
    }

    function showCoupon() {
        document.getElementById('survey-content').innerHTML = `
            <div class="text-center py-10 fade-in">
                <div class="w-20 h-20 bg-green-50 text-xigo rounded-full flex items-center justify-center mx-auto mb-8">
                    <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <p class="text-gray-400 font-bold text-[10px] uppercase tracking-widest mb-2">Tu cup√≥n es:</p>
                <div class="bg-gray-50 border-4 border-dashed border-gray-200 p-8 rounded-3xl mb-8">
                    <h2 class="text-xigo text-5xl font-black italic tracking-tighter">XIGO15</h2>
                </div>
                <p class="text-xs text-gray-500 italic px-4 leading-relaxed">Presenta este c√≥digo o una captura en <b>@vinamariaec</b> para validar tu descuento.</p>
                <button onclick="location.reload()" class="mt-12 text-gray-300 font-bold uppercase text-[9px] tracking-widest underline">Finalizar</button>
            </div>
        `;
    }

    function finishExit() {
        document.getElementById('survey-content').innerHTML = `
            <div class="text-center py-24 fade-in">
                <p class="text-gray-400 font-bold uppercase text-xs tracking-widest">Gracias por tu inter√©s en XIGO.</p>
                <button onclick="location.reload()" class="mt-8 text-xigo font-black uppercase text-[10px] underline">Volver al inicio</button>
            </div>
        `;
    }

    // --- PANEL DE ADMINISTRACI√ìN OCULTO ---
    document.getElementById('admin-trigger').onclick = () => {
        adminClicks++;
        if (adminClicks >= 5) {
            adminClicks = 0;
            const p = prompt("Acceso XIGO Admin:");
            if (p === "2026") openAdmin();
        }
    };

    function openAdmin() {
        const data = JSON.parse(localStorage.getItem('xigo_data') || '[]');
        const ui = document.getElementById('survey-content');
        ui.innerHTML = `
            <div class="fade-in space-y-6">
                <div class="bg-gray-900 text-white p-6 rounded-3xl">
                    <p class="text-[10px] font-bold text-xigo uppercase">Respuestas Totales</p>
                    <h3 class="text-5xl font-black italic">${data.length}</h3>
                    <button onclick="exportCSV()" class="mt-4 w-full bg-xigo py-3 rounded-xl font-bold uppercase text-xs">Descargar CSV (Excel)</button>
                </div>
                <div class="space-y-2">
                    ${data.slice(-5).reverse().map(d => `
                        <div class="p-3 bg-gray-50 rounded-xl text-[10px] flex justify-between">
                            <span class="font-bold">${d.email}</span>
                            <span class="text-gray-300">${new Date(d.date).toLocaleDateString()}</span>
                        </div>
                    `).join('')}
                </div>
                <button onclick="location.reload()" class="w-full py-4 text-gray-400 font-bold text-[10px] uppercase">Salir</button>
            </div>
        `;
    }

    window.exportCSV = () => {
        const data = JSON.parse(localStorage.getItem('xigo_data') || '[]');
        if (data.length === 0) return alert("No hay datos");
        
        const headers = ["Email", "Fecha", ...questions.map(q => q.id)];
        const rows = data.map(d => [
            d.email, 
            d.date, 
            ...questions.map(q => {
                const r = d.responses[q.id] || "";
                return Array.isArray(r) ? r.join(";") : r;
            })
        ].join(","));

        const content = "data:text/csv;charset=utf-8," + headers.join(",") + "\n" + rows.join("\n");
        const encodedUri = encodeURI(content);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "XIGO_RESULTADOS.csv");
        document.body.appendChild(link);
        link.click();
    };

    window.onload = init;
</script>
</body>
</html>
