<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XIGO - Encuesta de Mercado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --xigo-green: #2D5A27; --xigo-bg: #fdfdfd; }
        body { background-color: #eeeeee; font-family: 'Inter', system-ui, sans-serif; margin: 0; padding: 0; }
        
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
        }

        .header-compact {
            width: 100%;
            height: 140px; 
            overflow: hidden;
            background-color: var(--xigo-green);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-compact img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            object-position: center;
        }

        .option-card {
            width: 100%;
            text-align: left;
            padding: 14px 18px;
            margin-bottom: 8px;
            border: 2px solid #f1f5f9;
            border-radius: 12px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            color: #334155;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
        }
        .option-card:hover { border-color: #cbd5e1; }
        .option-card:active { transform: scale(0.98); }
        .selected {
            border-color: var(--xigo-green);
            background-color: #f0fdf4;
            color: var(--xigo-green);
        }

        .progress-container { height: 4px; background: #f1f5f9; width: 100%; }
        .progress-bar { height: 100%; background: var(--xigo-green); transition: width 0.4s ease; }

        .btn-primary {
            background: #1e293b;
            color: white;
            padding: 18px;
            border-radius: 12px;
            width: 100%;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    <header class="header-compact" id="logo-admin">
        <img src="https://lh3.googleusercontent.com/u/0/d/1WmKpnJPnBgB3OyYqe-a-OgRODLuuPjTq=w1000" alt="Logo XIGO" onerror="this.src='https://placehold.co/800x300/2D5A27/FFFFFF?text=XIGO+BEBIENDO+Y+COMIENDO'">
    </header>

    <div class="progress-container">
        <div id="progress" class="progress-bar" style="width: 0%"></div>
    </div>

    <div class="px-6 py-4 flex justify-between text-[9px] text-gray-400 font-bold uppercase tracking-widest">
        <span id="block-name">...</span>
        <span id="step-counter">1 / 23</span>
    </div>

    <main id="main-content" class="px-6 flex-1 overflow-y-auto pb-24">
        <!-- Contenido din√°mico -->
    </main>

    <footer id="footer-nav" class="fixed bottom-0 left-0 right-0 max-w-[480px] mx-auto p-6 bg-white border-t border-gray-100 hidden">
        <button onclick="processNext()" class="btn-primary">Continuar</button>
    </footer>
</div>

<script>
    const surveyData = [
        // BLOQUE 0: FILTRO
        { id: 'F1', b: 'Filtro', q: '¬øEn los √∫ltimos 30 d√≠as, has comprado comida preparada o empacada para consumir fuera de casa, trabajo o universidad?', o: ['S√≠, lo he comprado', 'No, pero lo considerar√≠a si fuera conveniente', 'No, no me interesa'], t: 'single', exit: 'No, no me interesa' },
        { id: 'F2', b: 'Filtro', q: '¬øCu√°l describe mejor tu situaci√≥n actual?', o: ['Trabajo fuera de casa', 'Trabajo desde casa / online', 'Trabajo mixto (Oficina + Casa)', 'Estudiante / No trabajo'], t: 'single' },
        { id: 'F3', b: 'Filtro', q: '¬øCon qu√© frecuencia almuerzas fuera de casa en una semana?', o: ['0 veces', '1-2 veces', '3-4 veces', '5+ veces'], t: 'single' },
        
        // BLOQUE 1: COMIDA
        { id: 'C1', b: 'Comida', q: '¬øHas comprado alguna vez comida preparada para consumir despu√©s (Refrigerada o en tarrinas empacadas)?', o: ['S√≠, regularmente', 'S√≠, algunas veces', 'No, pero me llama la atenci√≥n', 'No, no me interesa'], t: 'single' },
        { id: 'C2', b: 'Comida', q: '¬øEn qu√© situaciones considerar√≠as consumir comida lista durante un d√≠a laboral?', o: ['Poco tiempo para salir a almorzar', 'Reuniones o trabajo continuo', 'No alcanc√© a cocinarme', 'Para comer en la oficina', 'Entre reuniones o traslados', 'Para llevar a casa', 'No lo considerar√≠a'], t: 'multi', m: 7 },
        { id: 'C3', b: 'Comida', q: '¬øQu√© tipo de comida te genera m√°s apetito y confianza si viene lista y empacada?', o: ['Comida tradicional ecuatoriana', 'Comida casera ligera (arroz, carne asada, etc)', 'Bowls balanceados (sushi, prote√≠na, pasta)', 'Ensaladas completas', 'Sopas / Cremas', 'Snacks salados', 'No confiar√≠a en comida empacada'], t: 'multi', m: 3 },
        { id: 'C4', b: 'Comida', q: 'Para tu almuerzo/cena, ¬øqu√© tama√±o de porci√≥n prefieres normalmente?', o: ['Ligero (para no sentirse pesado)', 'Normal (me deja satisfecho)', 'Grande (me gusta quedar lleno)', 'Depende del d√≠a'], t: 'single' },
        { id: 'C5', b: 'Comida', q: '¬øQu√© esperas de un almuerzo para sentir que "vali√≥ la pena"?', o: ['Que me llene (porci√≥n)', 'Que sea saludable', 'Que tenga buena cantidad de prote√≠na', 'Que sea r√°pido y pr√°ctico', 'Que tenga muy buen sabor'], t: 'multi', m: 3 },
        { id: 'C6', b: 'Comida', q: '¬øQu√© factor te har√≠a dudar al comprar?', o: ['Frescura', 'Higiene', 'Sabor', 'Precio', 'Tama√±o de la porci√≥n', 'Uso de conservantes', 'Fecha de caducidad', 'Empaque sostenible'], t: 'multi', m: 3 },
        { id: 'C7', b: 'Comida', q: 'Si tuvieras acceso a comida lista y fresca cerca de tu rutina, ¬øcon qu√© frecuencia la consumir√≠as?', o: ['Nunca', '1 vez por semana', '2-3 veces por semana', 'Casi todos los d√≠as laborales'], t: 'single' },
        
        // BLOQUE 2: DELIVERY
        { id: 'D1', b: 'Delivery', q: '¬øConsiderar√≠as pedir comida lista por delivery si fuera confiable, fresca y de calidad?', o: ['S√≠, con frecuencia', 'S√≠, ocasionalmente', 'Tal vez', 'No'], t: 'single' },
        { id: 'D2', b: 'Delivery', q: 'Cuando piensas en delivery, ¬øqu√© formato te resulta m√°s atractivo?', o: ['Pedir una comida puntual', 'Pedir comida para 2-3 d√≠as', 'Pedir comida para toda la semana', 'Depende del d√≠a', 'No pedir√≠a por delivery'], t: 'single' },
        { id: 'D3', b: 'Delivery', q: '¬øCon qu√© frecuencia crees que la pedir√≠as por delivery?', o: ['Nunca', '1 vez por semana', '2-3 veces por semana', 'M√°s de 3 veces por semana'], t: 'single' },

        // BLOQUE 3: PRECIOS
        { id: 'P1', b: 'Precios', q: '¬øEn promedio, cu√°nto sueles pagar hoy por tu almuerzo entre semana?', o: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o m√°s', 'No pago almuerzo'], t: 'single' },
        { id: 'P2', b: 'Precios', q: '¬øQu√© precio te parece razonable para un almuerzo listo de excelente calidad nutricional?', o: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o m√°s'], t: 'single' },
        { id: 'P3', b: 'Precios', q: '¬øA partir de qu√© precio considerar√≠as que este tipo de almuerzo ya es CARO?', o: ['Menos de $4.99', '$5.99 - $7.99', '$7.99 - $9.99', '$9.99 - $11.99', '$11.99 o m√°s'], t: 'single' },
        { id: 'P4', b: 'Precios', q: 'Si un almuerzo de $5.99 sube a $7.99 por costos operativos, ¬øqu√© har√≠as?', o: ['Lo seguir√≠a comprando igual', 'Lo comprar√≠a con menos frecuencia', 'Buscar√≠a otra opci√≥n', 'Dejar√≠a de comprarlo'], t: 'single' },

        // BLOQUE 4: RTD (BEBIDAS)
        { id: 'R1', b: 'RTD', q: 'Durante tu jornada laboral, ¬øcompras bebidas listas para tomar?', o: ['S√≠, casi todos los d√≠as', 'Varias veces por semana', 'Ocasionalmente', 'Rara vez', 'Nunca'], t: 'single' },
        { id: 'R2', b: 'RTD', q: '¬øQu√© opci√≥n de bebida te resultar√≠a m√°s atractiva en tu d√≠a a d√≠a?', o: ['Agua natural o saborizada (baja az√∫car)', 'Jugo natural prensado / fresco', 'T√© fr√≠o o infusi√≥n natural', 'Caf√© latte y Matcha', 'Bebida funcional (energ√≠a/prote√≠na)', 'Bebida refrescante para el calor', 'No suelo comprar bebidas listas'], t: 'multi', m: 2 },
        { id: 'R3', b: 'RTD', q: 'Al comprar caf√© fr√≠o o smoothies, ¬øqu√© tipo de leche prefieres?', o: ['Leche regular (entera)', 'Leche deslactosada', 'Leche de almendra', 'Leche de avena', 'Leche de soya', 'No consumo bebidas con leche'], t: 'multi', m: 2 },
        { id: 'R4', b: 'RTD', q: '¬øQu√© precio te parece razonable para una bebida RTD de buena calidad?', o: ['Hasta $1.99', '$2.49 - $2.99', '$3.49 - $3.99', '$4.49 - $4.99', 'M√°s de $5.00'], t: 'single' },

        // BLOQUE FINAL: PERFIL
        { id: 'E1', b: 'Perfil', q: '¬øCu√°l es tu rango de edad?', o: ['18-24', '25-34', '35-44', '45-54', '55+'], t: 'single' },
        { id: 'Z1', b: 'Perfil', q: '¬øZona donde realizas la mayor√≠a de tus actividades?', o: ['Norte', 'Centro', 'Sur', 'Samborond√≥n / V√≠a a la Costa', 'Dur√°n'], t: 'single' }
    ];

    let currentIndex = 0;
    let userAnswers = {};
    let multiSelection = [];
    let clickCount = 0;

    function renderQuestion() {
        const item = surveyData[currentIndex];
        const container = document.getElementById('main-content');
        const footer = document.getElementById('footer-nav');
        
        document.getElementById('block-name').innerText = `Bloque: ${item.b}`;
        document.getElementById('step-counter').innerText = `${currentIndex + 1} / ${surveyData.length}`;
        document.getElementById('progress').style.width = `${((currentIndex) / surveyData.length) * 100}%`;
        
        multiSelection = [];
        footer.classList.add('hidden');

        container.innerHTML = `
            <div class="fade-in pt-6">
                <h2 class="text-xl font-extrabold text-slate-800 leading-tight mb-8">${item.q}</h2>
                <div class="space-y-2">
                    ${item.o.map(opt => `
                        <button onclick="selectOption('${opt.replace(/'/g, "\\'")}')" class="option-card">
                            <span>${opt}</span>
                            <div class="indicator w-2 h-2 rounded-full bg-slate-100"></div>
                        </button>
                    `).join('')}
                </div>
                ${item.t === 'multi' ? `<p class="text-[9px] text-center text-gray-400 mt-8 font-bold uppercase tracking-widest">Elige hasta ${item.m} opciones</p>` : ''}
            </div>
        `;
        container.scrollTop = 0;
    }

    window.selectOption = (val) => {
        const item = surveyData[currentIndex];
        if (item.t === 'single') {
            if (item.exit && val === item.exit) return showExit();
            userAnswers[item.id] = val;
            processNext();
        } else {
            if (multiSelection.includes(val)) {
                multiSelection = multiSelection.filter(x => x !== val);
            } else if (multiSelection.length < item.m) {
                multiSelection.push(val);
            }
            updateUI();
            document.getElementById('footer-nav').classList.remove('hidden');
        }
    }

    function updateUI() {
        document.querySelectorAll('.option-card').forEach(btn => {
            const text = btn.querySelector('span').innerText;
            if (multiSelection.includes(text)) btn.classList.add('selected');
            else btn.classList.remove('selected');
        });
    }

    window.processNext = () => {
        if (surveyData[currentIndex].t === 'multi') {
            userAnswers[surveyData[currentIndex].id] = multiSelection.join(" | ");
        }
        currentIndex++;
        if (currentIndex < surveyData.length) renderQuestion();
        else showFinal();
    }

    function showFinal() {
        document.getElementById('progress').style.width = "100%";
        document.getElementById('footer-nav').classList.add('hidden');
        document.getElementById('main-content').innerHTML = `
            <div class="text-center py-10 fade-in">
                <div class="text-5xl mb-6">ü•ó</div>
                <h2 class="text-3xl font-black text-slate-900 mb-4 italic uppercase">¬°Casi terminamos!</h2>
                <p class="text-slate-500 text-sm mb-8 leading-relaxed">Tu opini√≥n es valiosa para XIGO. D√©janos tu correo para enviarte tu cup√≥n del 15% para @vinamariaec:</p>
                <input type="email" id="user-email" placeholder="tu@correo.com" class="w-full p-5 bg-gray-50 rounded-xl mb-6 text-center font-bold border-2 border-transparent focus:border-green-600 outline-none transition-all">
                <button onclick="saveAndFinish()" class="btn-primary bg-green-800">Obtener Cup√≥n</button>
            </div>
        `;
    }

    function saveAndFinish() {
        const email = document.getElementById('user-email').value;
        if (!email.includes('@')) return alert("Por favor ingresa un correo v√°lido");
        
        const submission = { email, responses: {...userAnswers}, timestamp: new Date().toLocaleString() };
        const localData = JSON.parse(localStorage.getItem('xigo_storage') || '[]');
        localData.push(submission);
        localStorage.setItem('xigo_storage', JSON.stringify(localData));

        document.getElementById('main-content').innerHTML = `
            <div class="text-center py-10 fade-in">
                <div class="w-20 h-20 bg-green-100 text-green-700 flex items-center justify-center rounded-full mx-auto mb-6 text-3xl font-bold">‚úì</div>
                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Tu c√≥digo de descuento es:</p>
                <div class="p-8 border-4 border-dashed border-gray-100 rounded-3xl mb-8 bg-gray-50">
                    <h2 class="text-5xl font-black text-green-900 italic tracking-tighter">XIGO15</h2>
                </div>
                <p class="text-sm text-slate-600 mb-4">¬°T√≥male una captura de pantalla!</p>
                <p class="text-xs text-gray-400">V√°lido en tu pr√≥xima compra en Vina Mar√≠a.</p>
                <button onclick="location.reload()" class="mt-12 text-xs font-bold text-gray-300 uppercase tracking-widest">Cerrar encuesta</button>
            </div>
        `;
    }

    function showExit() {
        document.getElementById('main-content').innerHTML = `
            <div class="text-center py-24 fade-in">
                <p class="text-slate-400 font-bold uppercase tracking-widest mb-4">Gracias por tu inter√©s</p>
                <p class="text-sm text-slate-500 mb-8 px-10">La encuesta est√° dise√±ada para consumidores actuales de comida preparada.</p>
                <button onclick="location.reload()" class="text-green-700 font-bold underline">Reiniciar</button>
            </div>`;
    }

    // PANEL ADMIN
    document.getElementById('logo-admin').onclick = () => {
        clickCount++;
        if (clickCount >= 5) {
            clickCount = 0;
            if (prompt("Clave Admin:") === "2026") showAdminPanel();
        }
    }

    function showAdminPanel() {
        const data = JSON.parse(localStorage.getItem('xigo_storage') || '[]');
        document.getElementById('main-content').innerHTML = `
            <div class="py-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-black text-xl italic uppercase">Data XIGO (${data.length})</h2>
                    <button onclick="location.reload()" class="text-xs font-bold text-red-500">Cerrar</button>
                </div>
                <div class="grid grid-cols-1 gap-3 mb-8">
                    <button onclick="exportCleanText()" class="bg-slate-800 text-white py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest">Generar Reporte Completo (TXT)</button>
                    <button onclick="exportCSV()" class="bg-blue-600 text-white py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest">Descargar Datos (CSV)</button>
                </div>
                <div class="space-y-2">
                    ${data.reverse().map(d => `<div class="p-3 bg-gray-50 rounded border text-[10px]"><p class="font-bold">${d.email}</p><p class="text-gray-400">${d.timestamp}</p></div>`).join('')}
                </div>
            </div>
        `;
        document.getElementById('footer-nav').classList.add('hidden');
    }

    window.exportCleanText = () => {
        const data = JSON.parse(localStorage.getItem('xigo_storage') || '[]');
        if (data.length === 0) return alert("No hay datos para exportar");
        let content = "REPORTE DE ENCUESTAS XIGO\n========================\n\n";
        data.forEach((u, i) => {
            content += `ENCUESTA #${i+1} - ${u.email} (${u.timestamp})\n------------------------\n`;
            surveyData.forEach(q => {
                content += `${q.id}. ${q.q}\nR: ${u.responses[q.id] || '-'}\n\n`;
            });
            content += "========================\n\n";
        });
        const blob = new Blob([content], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `Reporte_XIGO_${new Date().toISOString().slice(0,10)}.txt`;
        link.click();
    }

    window.exportCSV = () => {
        const data = JSON.parse(localStorage.getItem('xigo_storage') || '[]');
        let csv = "Email,Fecha," + surveyData.map(q => q.id).join(",") + "\n";
        data.forEach(d => {
            let row = [d.email, d.timestamp];
            surveyData.forEach(q => row.push(`"${d.responses[q.id] || ''}"`));
            csv += row.join(",") + "\n";
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'datos_xigo.csv';
        link.click();
    }

    window.onload = renderQuestion;
</script>

</body>
</html>
